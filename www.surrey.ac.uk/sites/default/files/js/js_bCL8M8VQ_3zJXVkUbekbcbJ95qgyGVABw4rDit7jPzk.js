/**
* DO NOT EDIT THIS FILE.
* See the following change record for more information,
* https://www.drupal.org/node/2815083
* @preserve
**/

(function () {
  var settingsElement = document.querySelector('head > script[type="application/json"][data-drupal-selector="drupal-settings-json"], body > script[type="application/json"][data-drupal-selector="drupal-settings-json"]');
  window.drupalSettings = {};

  if (settingsElement !== null) {
    window.drupalSettings = JSON.parse(settingsElement.textContent);
  }
})();;
/**
* DO NOT EDIT THIS FILE.
* See the following change record for more information,
* https://www.drupal.org/node/2815083
* @preserve
**/

window.Drupal = {
  behaviors: {},
  locale: {}
};

(function (Drupal, drupalSettings, drupalTranslations, console, Proxy, Reflect) {
  Drupal.throwError = function (error) {
    setTimeout(function () {
      throw error;
    }, 0);
  };

  Drupal.attachBehaviors = function (context, settings) {
    context = context || document;
    settings = settings || drupalSettings;
    var behaviors = Drupal.behaviors;
    Object.keys(behaviors || {}).forEach(function (i) {
      if (typeof behaviors[i].attach === 'function') {
        try {
          behaviors[i].attach(context, settings);
        } catch (e) {
          Drupal.throwError(e);
        }
      }
    });
  };

  Drupal.detachBehaviors = function (context, settings, trigger) {
    context = context || document;
    settings = settings || drupalSettings;
    trigger = trigger || 'unload';
    var behaviors = Drupal.behaviors;
    Object.keys(behaviors || {}).forEach(function (i) {
      if (typeof behaviors[i].detach === 'function') {
        try {
          behaviors[i].detach(context, settings, trigger);
        } catch (e) {
          Drupal.throwError(e);
        }
      }
    });
  };

  Drupal.checkPlain = function (str) {
    str = str.toString().replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#39;');
    return str;
  };

  Drupal.formatString = function (str, args) {
    var processedArgs = {};
    Object.keys(args || {}).forEach(function (key) {
      switch (key.charAt(0)) {
        case '@':
          processedArgs[key] = Drupal.checkPlain(args[key]);
          break;

        case '!':
          processedArgs[key] = args[key];
          break;

        default:
          processedArgs[key] = Drupal.theme('placeholder', args[key]);
          break;
      }
    });
    return Drupal.stringReplace(str, processedArgs, null);
  };

  Drupal.stringReplace = function (str, args, keys) {
    if (str.length === 0) {
      return str;
    }

    if (!Array.isArray(keys)) {
      keys = Object.keys(args || {});
      keys.sort(function (a, b) {
        return a.length - b.length;
      });
    }

    if (keys.length === 0) {
      return str;
    }

    var key = keys.pop();
    var fragments = str.split(key);

    if (keys.length) {
      for (var i = 0; i < fragments.length; i++) {
        fragments[i] = Drupal.stringReplace(fragments[i], args, keys.slice(0));
      }
    }

    return fragments.join(args[key]);
  };

  Drupal.t = function (str, args, options) {
    options = options || {};
    options.context = options.context || '';

    if (typeof drupalTranslations !== 'undefined' && drupalTranslations.strings && drupalTranslations.strings[options.context] && drupalTranslations.strings[options.context][str]) {
      str = drupalTranslations.strings[options.context][str];
    }

    if (args) {
      str = Drupal.formatString(str, args);
    }

    return str;
  };

  Drupal.url = function (path) {
    return drupalSettings.path.baseUrl + drupalSettings.path.pathPrefix + path;
  };

  Drupal.url.toAbsolute = function (url) {
    var urlParsingNode = document.createElement('a');

    try {
      url = decodeURIComponent(url);
    } catch (e) {}

    urlParsingNode.setAttribute('href', url);
    return urlParsingNode.cloneNode(false).href;
  };

  Drupal.url.isLocal = function (url) {
    var absoluteUrl = Drupal.url.toAbsolute(url);
    var protocol = window.location.protocol;

    if (protocol === 'http:' && absoluteUrl.indexOf('https:') === 0) {
      protocol = 'https:';
    }

    var baseUrl = "".concat(protocol, "//").concat(window.location.host).concat(drupalSettings.path.baseUrl.slice(0, -1));

    try {
      absoluteUrl = decodeURIComponent(absoluteUrl);
    } catch (e) {}

    try {
      baseUrl = decodeURIComponent(baseUrl);
    } catch (e) {}

    return absoluteUrl === baseUrl || absoluteUrl.indexOf("".concat(baseUrl, "/")) === 0;
  };

  Drupal.formatPlural = function (count, singular, plural, args, options) {
    args = args || {};
    args['@count'] = count;
    var pluralDelimiter = drupalSettings.pluralDelimiter;
    var translations = Drupal.t(singular + pluralDelimiter + plural, args, options).split(pluralDelimiter);
    var index = 0;

    if (typeof drupalTranslations !== 'undefined' && drupalTranslations.pluralFormula) {
      index = count in drupalTranslations.pluralFormula ? drupalTranslations.pluralFormula[count] : drupalTranslations.pluralFormula.default;
    } else if (args['@count'] !== 1) {
      index = 1;
    }

    return translations[index];
  };

  Drupal.encodePath = function (item) {
    return window.encodeURIComponent(item).replace(/%2F/g, '/');
  };

  Drupal.deprecationError = function (_ref) {
    var message = _ref.message;

    if (drupalSettings.suppressDeprecationErrors === false && typeof console !== 'undefined' && console.warn) {
      console.warn("[Deprecation] ".concat(message));
    }
  };

  Drupal.deprecatedProperty = function (_ref2) {
    var target = _ref2.target,
        deprecatedProperty = _ref2.deprecatedProperty,
        message = _ref2.message;

    if (!Proxy || !Reflect) {
      return target;
    }

    return new Proxy(target, {
      get: function get(target, key) {
        if (key === deprecatedProperty) {
          Drupal.deprecationError({
            message: message
          });
        }

        for (var _len = arguments.length, rest = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {
          rest[_key - 2] = arguments[_key];
        }

        return Reflect.get.apply(Reflect, [target, key].concat(rest));
      }
    });
  };

  Drupal.theme = function (func) {
    if (func in Drupal.theme) {
      var _Drupal$theme;

      for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {
        args[_key2 - 1] = arguments[_key2];
      }

      return (_Drupal$theme = Drupal.theme)[func].apply(_Drupal$theme, args);
    }
  };

  Drupal.theme.placeholder = function (str) {
    return "<em class=\"placeholder\">".concat(Drupal.checkPlain(str), "</em>");
  };
})(Drupal, window.drupalSettings, window.drupalTranslations, window.console, window.Proxy, window.Reflect);;
/**
* DO NOT EDIT THIS FILE.
* See the following change record for more information,
* https://www.drupal.org/node/2815083
* @preserve
**/

if (window.jQuery) {
  jQuery.noConflict();
}

document.documentElement.className += ' js';

(function (Drupal, drupalSettings) {
  var domReady = function domReady(callback) {
    var listener = function listener() {
      callback();
      document.removeEventListener('DOMContentLoaded', listener);
    };

    if (document.readyState !== 'loading') {
      setTimeout(callback, 0);
    } else {
      document.addEventListener('DOMContentLoaded', listener);
    }
  };

  domReady(function () {
    Drupal.attachBehaviors(document, drupalSettings);
  });
})(Drupal, window.drupalSettings);;
"use strict";Drupal.behaviors.gdprManager={attach(e){const s={globals:{popup:"js-cookie-popup",popupElem:null,submit:"js-cookie-submit",toggles:[],pageToggles:[],userSettings:{saved:!1,insight:!0,marketing:!0}},init(){s.getUserSettings();var e=document.cookie.split(";");if(s.globals.userSettings.saved?!s.globals.userSettings.saved||s.globals.userSettings.insight||s.globals.userSettings.marketing?s.globals.userSettings.saved&&!s.globals.userSettings.insight?s.clearInsightCookies(e):s.globals.userSettings.saved&&!s.globals.userSettings.marketing&&s.clearMarketingCookies(e):(s.clearInsightCookies(e),s.clearMarketingCookies(e)):s.clearAllCookies(e),s.checkSettings(),!s.globals.userSettings.saved){s.globals.popupElem=document.getElementById(s.globals.popup),s.submitHandler(),s.showPopup(s.globals.popupElem);const t=document.getElementById("js-cookie-settings-link");t.addEventListener("click",function(e){e.preventDefault(),s.hidePopup(s.globals.popupElem),s.globals.userSettings.saved=!0,s.globals.userSettings.insight=!1,s.globals.userSettings.marketing=!1,s.updateLocalStorage();e=this.getAttribute("href");window.location.href=e})}document.getElementById("js-cookie-in-page")&&(s.globals.pageToggles=[...document.querySelectorAll("#js-cookie-in-page .cookie-toggle[data-setting]")],s.updateToggles(s.globals.pageToggles),s.setHandlers(s.globals.pageToggles))},getUserSettings(){var e=s.checkLocalStorage("uos_gdpr");e&&(s.globals.userSettings=e)},checkSettings(){s.globals.userSettings.insight&&s.globals.userSettings.saved?s.loadInsight():s.removeInsight(),s.globals.userSettings.marketing&&s.globals.userSettings.saved?s.loadMarketing():s.removeMarketing()},getToggles(){s.globals.toggles=[...document.querySelectorAll(".cookie-toggle[data-setting]")]},updateToggles(e){e.forEach(e=>{var t=e.getAttribute("data-setting");s.globals.userSettings.saved&&s.globals.userSettings[t]?e.checked=!0:s.globals.userSettings.saved&&!s.globals.userSettings[t]&&(e.checked=!1)})},setHandlers(e){e.forEach(e=>{e.addEventListener("change",function(){var e=this.checked,t=this.getAttribute("data-setting");s.globals.userSettings[t]=e,s.updateLocalStorage(),s.checkSettings()})})},submitHandler(){const e=document.getElementById(s.globals.submit);e.addEventListener("click",function(){s.globals.userSettings.saved=!0,s.updateLocalStorage(),s.hidePopup(s.globals.popupElem),s.checkSettings()})},showPopup(e){e.classList.remove("d-none"),setTimeout(()=>{e.classList.add("open")},50)},hidePopup(e){e.classList.remove("open"),setTimeout(()=>{e.classList.add("d-none")},250)},loadInsight(){if(!document.getElementById("js-inserted-ga-insight")&&s.globals.userSettings.saved){const e=document.createElement("script");e.type="text/javascript",e.id="js-inserted-ga-insight",e.innerHTML="(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':\n            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],\n            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=\n            'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);\n            })(window,document,'script','dataLayer','GTM-PQ53KG');",document.body.appendChild(e)}},removeInsight(){const e=document.getElementById("js-inserted-ga-insight");e&&(e.outerHTML="")},loadMarketing(){if(!document.getElementById("js-inserted-ga-marketing")&&s.globals.userSettings.saved){const e=document.createElement("script");e.type="text/javascript",e.id="js-inserted-ga-marketing",e.innerHTML="(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':\n            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],\n            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=\n            'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);\n            })(window,document,'script','dataLayer','GTM-MPMLWP8');",document.body.appendChild(e)}},removeMarketing(){const e=document.getElementById("js-inserted-ga-marketing");e&&(e.outerHTML="")},updateLocalStorage(){localStorage.setItem("uos_gdpr",JSON.stringify(s.globals.userSettings))},checkLocalStorage(e){return JSON.parse(localStorage.getItem(e))},clearInsightCookies(e){e.forEach(t=>{if(0<t.length){const s=t.split("=");document.domain;let e;(e=0<s[0].length?s[0].trim():e).startsWith("_g")&&(t=s[1]?s[1].trim():"",t="".concat(e,"=").concat(t||null,"; Max-Age=0; domain=.surrey.ac.uk; path=/"),document.cookie=t)}})},clearMarketingCookies(e){e.forEach(t=>{if(0<t.length){const s=t.split("=");document.domain;let e;(e=0<s[0].length?s[0].trim():e).startsWith("_g")||(t=s[1]?s[1].trim():"",t="".concat(e,"=").concat(t||null,"; Max-Age=0; domain=.surrey.ac.uk; path=/"),document.cookie=t)}})},clearAllCookies(e){s.clearMarketingCookies(e),s.clearInsightCookies(e)}};s.init()}};;
"use strict";const debounce=function(i){let e;return function(){const n=this,t=arguments;e&&window.cancelAnimationFrame(e),e=window.requestAnimationFrame(function(){i.apply(n,t)})}};;
"use strict";var clickCallback=function(e,t){t?(e.style.maxHeight="0px",e.addEventListener("transitionend",function(){e.hidden=!0})):(e.style.maxHeight=e.scrollHeight+"px",e.addEventListener("transitionend",function(){e.hidden=!1}),window.addEventListener("resize",function(){debounce(e.style.maxHeight=e.scrollHeight+"px")}))};Array.prototype.slice.call(document.querySelectorAll(".accordion")).forEach(function(n){var e,c=n.hasAttribute("data-allow-multiple"),l=c||n.hasAttribute("data-allow-toggle"),d=Array.prototype.slice.call(n.querySelectorAll(".accordion-trigger"));n.addEventListener("click",function(e){var t,a,r,i=e.target;i.classList.contains("accordion-trigger")&&(t="true"==i.getAttribute("aria-expanded"),a=n.querySelector('[aria-expanded="true"]'),r=document.getElementById(i.getAttribute("aria-controls")),!c&&a&&a!==i&&(a.setAttribute("aria-expanded","false"),l||a.removeAttribute("aria-disabled")),t?l&&t&&i.setAttribute("aria-expanded","false"):(i.setAttribute("aria-expanded","true"),r.hidden=!1,l||i.setAttribute("aria-disabled","true")),clickCallback(r,t),e.preventDefault())}),n.addEventListener("keydown",function(e){var t=e.target,a=e.which.toString(),r=e.ctrlKey&&a.match(/33|34/);if(t.classList.contains("accordion-trigger"))if(a.match(/38|40/)||r){var r=d.indexOf(t),t=a.match(/34|40/)?1:-1,i=d.length;d[(r+i+t)%i].focus(),e.preventDefault()}else if(a.match(/35|36/)){switch(a){case"36":d[0].focus();break;case"35":d[d.length-1].focus()}e.preventDefault()}}),n.querySelectorAll(".accordion-trigger").forEach(function(e){e.addEventListener("focus",function(){n.classList.add("focus")}),e.addEventListener("blur",function(){n.classList.remove("focus")})}),l||(e=n.querySelector('[aria-expanded="true"]'))&&e.setAttribute("aria-disabled","true")});;
"use strict";Drupal.behaviors.navigation={attach(e){const l={globals:{closeDropdownRef:null,navWrapper:null,currentlyOpen:{type:null,element:null,desktopButton:null},search:{id:"search",button:null,dropdown:null,isOpen:!1,input:null,hasSuggestions:!1,suggestions:[],currentTerm:null,suggestionsElement:document.getElementById("suggestions"),icons:document.getElementById("search-dropdown-icons"),submitButtonContainer:document.getElementById("search-dropdown-submit-button-container"),submitButton:document.getElementById("search-dropdown-submit-button"),form:document.getElementById("search-dropdown-form")},mobile:{id:"mobile",button:null,dropdown:null,isOpen:!1},desktop:{id:"desktop",buttons:null,isOpen:!1}},init(){l.globals.navWrapper=document.getElementById("global-nav"),l.globals.navWrapper.classList.contains("js-nav-processed")||(l.getElements(),l.addClickHandlers(),l.addCloseHandlers(),l.hideContainers(),l.addProcessedClass(),l.addSearchHandler())},addSearchHandler(){const e=l.globals.search["input"];e.addEventListener("input",function(e){if(0===this.value.length)return l.clearSuggestions(),l.adjustIconLinksVisibility("show"),void l.adjustSearchSubmitButtonVisibility("hide");l.adjustSearchSubmitButtonVisibility("show"),l.adjustIconLinksVisibility("hide"),this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{l.globals.search.currentTerm=this.value,l.getSuggestions(this.value)},250)}),e.addEventListener("keyup",function(e){e.preventDefault(),"ArrowDown"!==e.key&&"Down"!==e.key||"ArrowDown"!==e.key&&"Down"!==e.key||l.globals.search.hasSuggestions&&l.globals.search.suggestionsElement.firstChild.focus()})},getSuggestions(e){e=encodeURIComponent(e),e=new Request("https://surrey-search.clients.uk.funnelback.com/s/suggest.json?collection=surrey-meta&show=5&partial_query=".concat(e));fetch(e).then(e=>{if(200===e.status)return e.json();throw new Error("Something went wrong on api server!")}).then(e=>{e=e.filter((e,n,o)=>o.indexOf(e)==n).slice(0,3);l.updateSuggestions(e)}).catch(e=>console.error(e))},submitForm(){l.globals.search.form.submit()},clearSuggestions(){l.globals.search.hasSuggestions=!1,l.globals.search.suggestionsElement.innerHTML=""},updateSuggestions(e){const{suggestionsElement:n,input:t}=l.globals.search;if(0!==e.length){let o="";e.forEach((e,n)=>{e='<a class="search-suggestion d-block text-white" href="/search?query='.concat(encodeURIComponent(e),'">').concat(e,"</a>");o+=e}),n.innerHTML=o,l.globals.search.hasSuggestions=!0;const s=document.querySelectorAll(".search-suggestion");s.forEach(e=>{e.addEventListener("keydown",function(e){["Up","Down","ArrowUp","ArrowDown"].includes(e.key)&&(e.preventDefault(),"ArrowDown"===e.key||"Down"===e.key?e.target.nextElementSibling&&e.target.nextElementSibling.focus():"ArrowUp"!==e.key&&"Up"!==e.key||(e.target.previousElementSibling?e.target.previousElementSibling.focus():(e=t.value["length"],t.setSelectionRange(e,e),t.focus())))})})}},adjustIconLinksVisibility(e){const n=l.globals.search["icons"];if(e&&n)switch(e){case"hide":n.classList.add("d-none");break;case"show":n.classList.remove("d-none")}},adjustSearchSubmitButtonVisibility(e){const n=l.globals.search["submitButtonContainer"];if(e&&n)switch(e){case"hide":n.classList.add("d-none");break;case"show":n.classList.remove("d-none")}},closeDropdownOnScrollPosition(){const e=document.querySelector(".search-container");window.scrollY>window.pageYOffset+e.getBoundingClientRect().top+e.offsetHeight&&l.closeOpenDropdown()},addScrollHandler(){window.addEventListener("scroll",l.globals.closeDropdownRef=debounce(l.closeDropdownOnScrollPosition))},removeScrollHandler(){window.removeEventListener("scroll",l.globals.closeDropdownRef)},addProcessedClass(){l.globals.navWrapper.classList.add("js-nav-processed")},getElements(){l.globals.desktop.buttons=document.getElementById("global-nav-inner").querySelectorAll(".nav-item > .nav-link"),l.globals.mobile.button=document.getElementById("mobile-nav-toggle"),l.globals.mobile.dropdown=document.getElementById("mobile-nav"),l.globals.search.button=document.getElementById("search-dropdown-button"),l.globals.search.dropdown=document.getElementById("js-search-container"),l.globals.search.input=document.getElementById("dropdownSearchTermInput")},addClickHandlers(){const{desktop:e,mobile:n,search:o}=l.globals;e.buttons.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();e=l.isSomethingElseOpen().isDesktopOpen;e&&this.parentNode===l.globals.currentlyOpen.element?l.closeOpenDropdown():(e&&this.parentNode!==l.globals.currentlyOpen.element&&l.closeOpenDropdown(),l.openDesktopDropdown(this))})}),n.button.addEventListener("click",function(e){e.preventDefault();e=l.isSomethingElseOpen().isMobileOpen;e?l.closeOpenDropdown():l.openMobileDropdown()}),o.button.addEventListener("click",function(e){e.preventDefault();e=l.isSomethingElseOpen().isSearchOpen;if(e)l.closeOpenDropdown();else{l.openSearchDropdown();const n=document.getElementById("dropdownSearchTermInput");n.focus()}}),o.submitButton.addEventListener("click",function(e){e.preventDefault(),o.form.submit()})},hideContainers(){const e=l.globals.navWrapper.querySelectorAll(".nav-container a");e.forEach(e=>{e.textContent.includes("Container")&&e.parentNode.classList.add("bodged-nav")})},addCloseHandlers(){document.addEventListener("keyup",e=>{"Escape"===e.key&&l.closeOpenDropdown()}),document.addEventListener("click",e=>{l.globals.navWrapper.contains(e.target)||l.closeOpenDropdown()})},openDesktopDropdown(e){var n=l.isSomethingElseOpen()["isSearchOpen"];n&&l.closeOpenDropdown(),e.parentNode.classList.add("nav-active"),e.setAttribute("aria-expanded",!0),l.globals.desktop.isOpen=!0,l.globals.currentlyOpen.element=e.parentNode,l.globals.currentlyOpen.desktopButton=e,l.globals.currentlyOpen.type=l.globals.desktop.id},openMobileDropdown(){var e=l.isSomethingElseOpen()["isSearchOpen"];e&&l.closeOpenDropdown(),l.globals.mobile.dropdown.classList.remove("d-none"),l.globals.mobile.button.classList.add("mobile-nav-open"),l.globals.mobile.button.setAttribute("aria-expanded",!0),l.globals.mobile.isOpen=!0,l.globals.currentlyOpen.element=l.globals.mobile.dropdown,l.globals.currentlyOpen.type=l.globals.mobile.id},openSearchDropdown(){var{isDesktopOpen:e,isMobileOpen:n}=l.isSomethingElseOpen();(e||n)&&l.closeOpenDropdown(),l.globals.search.dropdown.classList.add("nav-active"),l.globals.search.button.setAttribute("aria-expanded",!0),l.globals.search.isOpen=!0,l.addScrollHandler(),l.globals.currentlyOpen.element=l.globals.search.dropdown,l.globals.currentlyOpen.type=l.globals.search.id},closeOpenDropdown(){var e=l.globals.currentlyOpen["type"];if(e){switch(e){case l.globals.mobile.id:l.globals.currentlyOpen.element.classList.add("d-none"),l.globals.mobile.button.classList.remove("mobile-nav-open"),l.globals.mobile.button.setAttribute("aria-expanded",!1),l.globals.mobile.isOpen=!1;break;case l.globals.search.id:l.globals.currentlyOpen.element.classList.remove("nav-active"),l.globals.search.button.setAttribute("aria-expanded",!1),l.globals.search.isOpen=!1,l.removeScrollHandler();break;case l.globals.desktop.id:l.globals.currentlyOpen.element.classList.remove("nav-active"),l.globals.currentlyOpen.desktopButton.setAttribute("aria-expanded",!1),l.globals.desktop.isOpen=!1}l.globals.currentlyOpen={type:null,element:null,desktopButton:null}}},isSomethingElseOpen(e){var{desktop:n,mobile:o,search:t}=l.globals;return{isDesktopOpen:n.isOpen,isMobileOpen:o.isOpen,isSearchOpen:t.isOpen}}};l.init()}};;
